<!DOCTYPE html>
<html>

<head>
	<title></title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
	<script src="https://cdn.jsdelivr.net/npm/ol@v7.3.0/dist/ol.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.3.0/ol.css">

	<style>
		html,
		body {
			margin: 0;
			height: 100%;
		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
		}
	</style>
</head>

<body>
	<div id="map"></div>
	<div id="popup" style="padding: 10px;background-color: white; display:none"></div>

	<script>
		window.API = {
			_x: 0,
			_y: 0,
			_mapX: 0,
			_mapY: 0,
			mousedown: function(x, y){
				this._x = x
				this._y = y
				const event = new PointerEvent('pointerdown', {
					view: window,
					pointerType: 'mouse',
					bubbles: true,
					cancelable: true,
					screenX: x,
					screenY: y,
					clientX: x,
					clientY: y,
					layerX: x,
					layerY: y,
					x: x,
					y: y,
				})

				const element = document.elementFromPoint(x, y)
				element.dispatchEvent(event)
			},
			mousemove: function(x, y){
				if(Math.abs(x - this._x) > 1 || Math.abs(y - this._y) > 1){
					const event = new PointerEvent('pointermove', {
						view: window,
						pointerType: 'mouse',
						bubbles: true,
						cancelable: true,
						screenX: x,
						screenY: y,
						clientX: x,
						clientY: y,
						layerX: x,
						layerY: y,
						x: x,
						y: y,
					})
					

					const element = document.elementFromPoint(x, y)
					element.dispatchEvent(event)
				}
				
			},
			mouseup: function(x, y){
				this._x = x
				this._y = y
				const event = new PointerEvent('pointerup', {
					view: window,
					pointerType: 'mouse',
					bubbles: true,
					cancelable: true,
					screenX: x,
					screenY: y,
					clientX: x,
					clientY: y,
					layerX: x,
					layerY: y,
					x: x,
					y: y,
				})

				const element = document.elementFromPoint(x, y)
				element.dispatchEvent(event)

				return `${this._mapX},${this._mapY}`
			},
		}

		const popup = document.getElementById('popup');
		const styles = [
			new ol.style.Style({
				stroke: new ol.style.Stroke({
					color: 'blue',
					width: 3,
				}),
				fill: new ol.style.Fill({
					color: 'rgba(0, 0, 255, 0.1)',
				}),
			}),
			new ol.style.Style({
				image: new ol.style.Circle({
					radius: 5,
					fill: new ol.style.Fill({
						color: 'orange',
					}),
				}),
				geometry: function (feature) {
					// return the coordinates of the first ring of the polygon
					const coordinates = feature.getGeometry().getCoordinates()[0];
					return new ol.geom.MultiPoint(coordinates);
				},
			}),
		];
		

		const source = new ol.source.Vector({
			features: []
		});

		const layer = new ol.layer.Vector({
			source: source,
			style: styles,
		});
		const map = new ol.Map({
			target: 'map',
			layers: [
				new ol.layer.Tile({
					source: new ol.source.XYZ({
						attributions: [
							ol.source.OSM.ATTRIBUTION,
							'Tiles courtesy of ' +
							'<a href="http://openstreetmap.org">' +
							'OpenStreetMap' +
							'</a>'
						],
						url: 'http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png'
					})
				}),
				layer,
			],
			controls: ol.control.defaults.defaults({
				attributionOptions: {
					collapsed: true
				}
			}).extend([
				new ol.control.ScaleLine()
			]),
			view: new ol.View({
				center: [0, 0],
				zoom: 2,
			}),
		});

		// let testFeature = new ol.Feature({
		// 	geometry: new ol.geom.Circle({
		// 		radius: 5000,
		// 		center: ol.proj.transform([0, 0], 'EPSG:4326','EPSG:3857')
		// 	})
		// })
		// testFeature.setStyle(new ol.style.Style({
		// 	fill: new ol.style.Fill({
		// 		color: '#f00',
		// 	})
		// }))
		// source.addFeature(testFeature)
		

		map.on('click', function (e) {
			window.API._mapX = e.pixel[0]
			window.API._mapY = e.pixel[1]
			// var info = [];
			// console.log(e)
			// map.forEachFeatureAtPixel(e.pixel, function (feature) {
			// 	info.push(feature.get('id'));
			// });
			// if (info.length > 0) {
			// 	popup.innerHTML = info.join(',');
			// 	popup.style.display = 'inline';
			// } else {
			// 	popup.innerHTML = '&nbsp;';
			// 	popup.style.display = 'none';
			// }
		});
	</script>
</body>

</html>